## [DB]()

---

## JOIN

두개이상의 테이블의 데이터를 하나의 결과물로 만드는 것을 조인(JOIN) 이라고 합니다.

- INNER JOIN : A,B 테이블 두 행이 모두 일지하는 행이 있는 부분만 표기합니다.

- LEFT JOIN : A 테이블 기준으로 데이터 조회 B 테이블에 일치하는 데이터 없으면 null 값으로 표현

- RIGHT JOIN : B 테이블 기준으로 데이터 조회 A 테이블에 일치하는 데이터 없으면 null 값으로 표현

- CROSS JOIN : A \* B 테이블의 모든 결과를 조회

## 조인의 원리

### **중첩 루프 조인**

-> 첫번째 테이블에서 행을 한번에 하나씩 읽고, 다음 테이블에서도 행을 하나씩 읽어 조건에 맞는 레코드를 찾아 결과를 표현하는 조인

- 랜덤 접근에 대한 비용이 많이 증가하므로 대용량의 테이블에서는 사용하지 않습니다.

### **정렬 병합조인**

-> 조인할 필드 기준으로 정렬하고, 이후에 조인 작업을 수행하는 조인

- 적절한 인덱스가 없고 대용량의 테이블들을 조인하고 조인조건으로 범위 비교 연산자가 있을때 사용합니다.

### **해시조인**

-> 해시테이블 기반 조인, 하나의 테이블이 메모리에 온전히 들어간다면 보통 중첩 루프 조인 보다 더 효울적입니다.

- 두 테이블중 작은 테이블을 메모리에 올림 (빌드단계) -> 메모리에 올라간 상태에서 필드가 키로 사용됨

- 해시테이블 기반으로 데이터 조회 (프로브 단계)

### **트랜잭션**

- 논리적 기능을 수행하기 위한 작업의 단위

- 여러개의 쿼리를 하나로 묶는 단위

### **트랜잭션 ACID**

#### 원자성(Atomicity)

- 트랜잭션과 관련된 일이 모두 수행되거나 수행되지 않거나를 보장하는 성질(all or nothing)

- 커밋과 롤백을 통해 데이터의 무결성이 보장

- 스프링 -> 여러 트랜잭션 관련 메서드의 호출을 하나의 트랜잭션에 묶이도록 함(트랜잭션 전파) - @Transaction

#### 일관성(Consistency)

- 데이터는 여러가지 조건, 규칙에 따라 유효함을 가져야 한다.
- 트랜잭션이 종료 되었을 때 무결성이 보장되어야 한다.
- 유니크 제약, 외래키 제약 등

#### 격리성(Isolation)

- 트랜잭션은 서로 간섭하지 않고 독립적으로 동작한다.
- 수행중인 트랜잭션은 완전히 완료될 때까지 다른 트랜잭션에서 수행 결과를 참조할 수 없다.

#### 지속성(durability)

- 성공적으로 수행된 트랜잭션은 영원히 반영되어야 한다.
- 시스템 장애가 발생해도 원래 상태를 복구하는 회복 기능 필요
- 체크섬(중복검사), 저널링(변경 사항을 커밋하기전에 로깅 WAL), 롤백

### **트랜잭션의 격리 수준**

#### SERIALIZABLE

- 트랜잭션을 순차적으로 진행
- 여러 트랜잭션이 동시에 같은 행에 접근할 수 없다. → 트랜잭션이 완료될때까지 기다려한다. → 교착상태 발생 가능성이 있음

### REPEATABLE_READ

- 여러 트랜잭션이 동시에 같은 행을 접근 할 수 있으나, 수정이 불가함

#### READ_COMMITED

- 커밋이 완료된 데이터에 대해서만 조회 허용
- Non-Repeatable-Read(행 수정시), phantom read(행 추가, 삭제시) 발생가능성이 있다.

#### READ_UNCOMMITTED

- 한 트랜잭션이 커밋되기 전에 다른 트랜잭에 노출 됨
- Dirty Read - 커밋되지 않은 행을 읽는다.
